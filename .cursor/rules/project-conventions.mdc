---
description: Coding conventions for PETL-AST project (authors' codebase)
alwaysApply: true
---

# Project Context

We are using the published codebase from https://github.com/umbertocappellazzo/PETL_AST to reproduce the Conformer Adapter results on ESC-50. The core code under `src/`, `dataset/`, `utils/`, `hparams/`, and `main.py` is the **authors' code**. We modify minimally and document every change.

# Rules

- **Python 3.10** â€” hard requirement from course.
- **Minimize changes to authors' code.** If you must modify, add a comment `# MODIFIED: <reason>` above the change. This makes it easy to diff against the original and document in the report.
- When adding NEW files (like `evaluation.py`), follow the authors' style: no type hints (they don't use them), same import patterns, same naming conventions.
- The training command for our experiment:
  `python main.py --data_path 'data' --dataset_name 'ESC-50' --method 'adapter' --adapter_block 'conformer' --adapter_type 'Pfeiffer' --seq_or_par 'parallel' --reduction_rate_adapter 96 --kernel_size 8 --apply_residual False --is_AST True`
- Hyperparameters live in `hparams/train.yaml`. Don't duplicate them elsewhere.
- The professor may ask any team member to explain any function. Keep code understandable.

# Known Issues (do NOT "fix")

- `Conformer_adapter.forward()`: LayerNorm output is computed then overwritten (`out = self.lnorm(x)` then `out = x.transpose(-1, -2)`). This is in the published code and produced the reported results.
- Pfeiffer config: paper says "parallel to MHSA" but code places adapter parallel to FFN. Follow the code.

# Key Reference

- Execution plan: `docs/planning/execution-plan.md`
- Authors' hyperparams: `hparams/train.yaml`
